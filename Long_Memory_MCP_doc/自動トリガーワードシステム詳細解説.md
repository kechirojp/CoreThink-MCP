è‡ªå‹•ãƒˆãƒªã‚¬ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã®ä»•çµ„ã¿ã«ã¤ã„ã¦è©³ã—ãèª¬æ˜ã„ãŸã—ã¾ã™ã€‚ã¾ãšã€ç¾åœ¨ã®å®Ÿè£…çŠ¶æ³ã‚’ç¢ºèªã—ã¦ã‹ã‚‰ã€ãƒ•ãƒ­ãƒ¼ã¨è‡ªå‹•åŒ–ã®ä»•çµ„ã¿ã‚’è§£èª¬ã—ã¾ã™ã€‚ ç¾åœ¨ã®å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç¢ºèªã—ã¦ã€è‡ªå‹•ãƒˆãƒªã‚¬ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã®ä»•çµ„ã¿ã‚’è©³ã—ãèª¬æ˜ã—ã¾ã™ã€‚ # ğŸš€ è‡ªå‹•ãƒˆãƒªã‚¬ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚·ã‚¹ãƒ†ãƒ è©³ç´°è§£èª¬

## 1ï¸âƒ£ **ã‚·ã‚¹ãƒ†ãƒ ãƒ•ãƒ­ãƒ¼**

### **ğŸ“‹ å®Œå…¨ãªå‹•ä½œãƒ•ãƒ­ãƒ¼**

```mermaid
graph TD
    A[ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™ºè¨€] --> B[AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå—ä¿¡]
    B --> C{ä¼šè©±è¡Œæ•°ãƒã‚§ãƒƒã‚¯}
    C -->|100è¡Œä»¥ä¸Š| D[è‡ªå‹•Resourcesèª­ã¿è¾¼ã¿]
    C -->|é€šå¸¸| E[ãƒˆãƒªã‚¬ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œå‡º]
    
    E --> F[yamlè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿]
    F --> G[ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãƒãƒƒãƒãƒ³ã‚°]
    G --> H{ãƒãƒƒãƒãƒ³ã‚°çµæœ}
    
    H -->|é«˜å„ªå…ˆåº¦| I[å³åº§ã«è¨˜æ†¶æ¤œç´¢]
    H -->|é€šå¸¸å„ªå…ˆåº¦| J[ãƒ‡ãƒã‚¦ãƒ³ã‚¹åˆ¤å®š]
    H -->|ãƒãƒƒãƒãªã—| K[é€šå¸¸å‡¦ç†]
    
    J --> L{10ç§’ä»¥å†…ã®é‡è¤‡?}
    L -->|No| M[search_memorieså®Ÿè¡Œ]
    L -->|Yes| N[ã‚¹ã‚­ãƒƒãƒ—]
    
    D --> O[å‰ææ¡ä»¶è£œå®Œ]
    I --> M
    M --> P[è¨˜æ†¶ãƒ‡ãƒ¼ã‚¿å–å¾—]
    O --> P
    P --> Q[ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆçµ±åˆ]
    Q --> R[AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå¿œç­”ç”Ÿæˆ]
    R --> S[ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«è¿”ç­”]
```

### **ğŸ”§ æŠ€è¡“çš„ãƒ•ãƒ­ãƒ¼è©³ç´°**

#### **Phase 1: å…¥åŠ›æ¤œå‡º**
```python
# ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™ºè¨€: "æ˜¨æ—¥ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä»¶ã€ã©ã†ãªã£ãŸï¼Ÿ"
user_message = "æ˜¨æ—¥ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä»¶ã€ã©ã†ãªã£ãŸï¼Ÿ"

# 1. ãƒˆãƒ¼ã‚¯ãƒ³æ­£è¦åŒ–
normalized_tokens = ["æ˜¨æ—¥", "ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ", "ä»¶", "ã©ã†", "ãªã£", "ãŸ"]

# 2. ãƒˆãƒªã‚¬ãƒ¼è¨­å®šèª­ã¿è¾¼ã¿
config = load_trigger_config("kechirojp")  # ãƒ¦ãƒ¼ã‚¶ãƒ¼å°‚ç”¨è¨­å®š
```

#### **Phase 2: ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãƒãƒƒãƒãƒ³ã‚°**
```python
# 3. ã‚«ãƒ†ã‚´ãƒªåˆ¥ãƒãƒƒãƒãƒ³ã‚°
matched_triggers = []

# temporal ã‚«ãƒ†ã‚´ãƒª
if "æ˜¨æ—¥" in normalized_tokens:
    matched_triggers.append({
        "word": "æ˜¨æ—¥",
        "category": "temporal", 
        "priority": "normal",
        "match_type": "token"
    })

# project ã‚«ãƒ†ã‚´ãƒª  
if "ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ" in normalized_tokens:
    matched_triggers.append({
        "word": "ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ",
        "category": "project",
        "priority": "normal", 
        "match_type": "token"
    })
```

#### **Phase 3: è‡ªå‹•å®Ÿè¡Œåˆ¤å®š**
```python
# 4. å„ªå…ˆåº¦ã¨ãƒ‡ãƒã‚¦ãƒ³ã‚¹åˆ¤å®š
current_time = time.time()
user_last_trigger = last_trigger_time.get("kechirojp", 0)

if current_time - user_last_trigger > 10:  # 10ç§’ãƒ‡ãƒã‚¦ãƒ³ã‚¹
    # 5. è‡ªå‹•æ¤œç´¢å®Ÿè¡Œ
    query = generate_smart_query(matched_triggers, user_message)
    # "æ˜¨æ—¥ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ é€²æ— çŠ¶æ³"
    
    memories = search_memories({
        "query": query,
        "user_id": "kechirojp", 
        "recent": True,
        "top_k": 5
    })
```

#### **Phase 4: é€æ˜çµ±åˆ**
```python
# 6. ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆçµ±åˆï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã¯è¦‹ãˆãªã„ï¼‰
enhanced_context = {
    "user_message": user_message,
    "retrieved_memories": memories,
    "trigger_info": matched_triggers,
    "session_context": session_prerequisites
}

# 7. AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå¿œç­”ç”Ÿæˆ
response = ai_agent.generate_response(enhanced_context)
# "æ˜¨æ—¥ãŠè©±ã—ã—ãŸ Reactãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®Phase 3ã§ã™ã­ã€‚
#  ç¾åœ¨ã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆè¨­è¨ˆãŒå®Œäº†ã—ã¦..."
```

## 2ï¸âƒ£ **ä½•ãŒè‡ªå‹•ãªã®ã‹ï¼Ÿ**

### **ğŸ¯ å®Œå…¨è‡ªå‹•åŒ–ã•ã‚Œã‚‹è¦ç´ **

#### **1. ãƒˆãƒªã‚¬ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œå‡ºï¼ˆå®Œå…¨è‡ªå‹•ï¼‰**
```yaml
# config/triggers/japanese.yaml
temporal:
  words: ["æ˜¨æ—¥", "å…ˆé€±", "ä»Šé€±", "å…ˆæœˆ", "ä»¥å‰", "å‰å›"]
  
# ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒ "æ˜¨æ—¥ã®ä»¶" ã¨è¨€ã†ã ã‘ã§è‡ªå‹•æ¤œå‡º
# â†’ æ‰‹å‹•ã‚³ãƒãƒ³ãƒ‰ä¸è¦
```

#### **2. è¨˜æ†¶æ¤œç´¢ã‚¯ã‚¨ãƒªç”Ÿæˆï¼ˆå®Œå…¨è‡ªå‹•ï¼‰**
```python
# å…¥åŠ›: "æ˜¨æ—¥ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã©ã†ãªã£ãŸï¼Ÿ"
# è‡ªå‹•ç”Ÿæˆã‚¯ã‚¨ãƒª: "ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ é€²æ— æ˜¨æ—¥ çŠ¶æ³"
# â†’ ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯æ¤œç´¢ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’è€ƒãˆã‚‹å¿…è¦ãªã—
```

#### **3. user_idç®¡ç†ï¼ˆå®Œå…¨è‡ªå‹•ï¼‰**
```python
# AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒè‡ªå‹•ã§user_idã‚’ä»˜ä¸
# â†’ ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯èªè¨¼ã‚„IDç®¡ç†ã‚’æ„è­˜ã—ãªã„
request.user_id = auto_detect_user_id(session_context)
```

#### **4. ãƒ‡ãƒã‚¦ãƒ³ã‚¹åˆ¶å¾¡ï¼ˆå®Œå…¨è‡ªå‹•ï¼‰**
```python
# 10ç§’ä»¥å†…ã®é‡è¤‡ãƒˆãƒªã‚¬ãƒ¼ã‚’è‡ªå‹•ã‚¹ã‚­ãƒƒãƒ—
# â†’ é€£ç¶šç™ºç«ã«ã‚ˆã‚‹æ€§èƒ½åŠ£åŒ–ã‚’è‡ªå‹•é˜²æ­¢
if current_time - last_trigger_time < 10:
    skip_automatic_search()
```

#### **5. å„ªå…ˆåº¦åˆ¤å®šï¼ˆå®Œå…¨è‡ªå‹•ï¼‰**
```python
# é«˜å„ªå…ˆåº¦ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰: "å‰æ", "åˆ¶ç´„", "æ±ºå®šäº‹é …"
# â†’ å³åº§ã«è¨˜æ†¶æ¤œç´¢å®Ÿè¡Œï¼ˆãƒ‡ãƒã‚¦ãƒ³ã‚¹ç„¡è¦–ï¼‰
if priority == "high":
    force_execute_search()
```

#### **6. è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç†ï¼ˆå®Œå…¨è‡ªå‹•ï¼‰**
```python
# ãƒ•ã‚¡ã‚¤ãƒ«å¤‰æ›´æ¤œå‡ºã§è‡ªå‹•ãƒªãƒ­ãƒ¼ãƒ‰
# â†’ ã‚µãƒ¼ãƒãƒ¼å†èµ·å‹•ä¸è¦
file_watcher.on_modified("triggers/*.yaml"):
    auto_reload_trigger_config()
```

### **ğŸ”„ åŠè‡ªå‹•åŒ–ã•ã‚Œã‚‹è¦ç´ **

#### **1. ã‚«ã‚¹ã‚¿ãƒ ãƒˆãƒªã‚¬ãƒ¼ä½œæˆï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼é¸æŠï¼‰**
```yaml
# config/triggers/custom/kechirojp_triggers.yaml
# ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå¿…è¦ã«å¿œã˜ã¦è¿½åŠ å¯èƒ½
custom_categories:
  ai_development:
    words: ["MCP", "ã‚¨ãƒ³ãƒ™ãƒ‡ã‚£ãƒ³ã‚°", "ãƒ™ã‚¯ãƒˆãƒ«æ¤œç´¢"]
```

#### **2. å„ªå…ˆåº¦èª¿æ•´ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼é¸æŠï¼‰**
```yaml
# priority: "high" | "normal" | "context_dependent"
# ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒé‡è¦åº¦ã«å¿œã˜ã¦è¨­å®šå¤‰æ›´å¯èƒ½
```

### **âŒ æ‰‹å‹•æ“ä½œãŒä¸è¦ãªè¦ç´ **

#### **å¾“æ¥ã®æ‰‹å‹•ã‚³ãƒãƒ³ãƒ‰ï¼ˆå»ƒæ­¢ï¼‰**
```python
# âŒ æ‰‹å‹•ã‚³ãƒãƒ³ãƒ‰ï¼ˆæœ€æ‚ªUXï¼‰
search_memories("æ˜¨æ—¥ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ")
mcp_client.call_tool("search_memories", {...})

# âœ… è‡ªå‹•åŒ–ï¼ˆç†æƒ³UXï¼‰  
"æ˜¨æ—¥ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã©ã†ãªã£ãŸï¼Ÿ"  # æ™®é€šã®ä¼šè©±ã ã‘
```

#### **æ‰‹å‹•è¨­å®šï¼ˆä¸è¦ï¼‰**
```python
# âŒ æ‰‹å‹•è¨­å®š
user_id = "kechirojp"
search_params = {"recent": True, "top_k": 5}

# âœ… è‡ªå‹•è¨­å®š
# ã™ã¹ã¦AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒè‡ªå‹•ç®¡ç†
```

## ğŸ¯ **å®Ÿéš›ã®å‹•ä½œä¾‹**

### **ä¾‹1: æ™‚ç³»åˆ—å‚ç…§ã®è‡ªå‹•æ¤œç´¢**
```
ãƒ¦ãƒ¼ã‚¶ãƒ¼: "å…ˆé€±è©±ã—ãŸæ©Ÿæ¢°å­¦ç¿’ã®ãƒ¢ãƒ‡ãƒ«ã€çµæœã©ã†ã§ã—ãŸï¼Ÿ"

è‡ªå‹•å®Ÿè¡Œãƒ•ãƒ­ãƒ¼:
1. "å…ˆé€±" â†’ temporal ã‚«ãƒ†ã‚´ãƒªæ¤œå‡º
2. "æ©Ÿæ¢°å­¦ç¿’" â†’ ai_development ã‚«ãƒ†ã‚´ãƒªæ¤œå‡º  
3. "ãƒ¢ãƒ‡ãƒ«" â†’ æŠ€è¡“ç”¨èªæ¤œå‡º
4. è‡ªå‹•ã‚¯ã‚¨ãƒªç”Ÿæˆ: "æ©Ÿæ¢°å­¦ç¿’ ãƒ¢ãƒ‡ãƒ« å…ˆé€± çµæœ"
5. search_memories è‡ªå‹•å®Ÿè¡Œ
6. é–¢é€£è¨˜æ†¶ã‚’è‡ªå‹•å–å¾—
7. ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆçµ±åˆã—ã¦AIå¿œç­”

AIå¿œç­”: "å…ˆé€±ãŠè©±ã—ã—ãŸ CNN ãƒ¢ãƒ‡ãƒ«ã®å­¦ç¿’çµæœã§ã™ã­ã€‚
ç²¾åº¦ãŒ 94.2% ã«é”ã—ã¦ã€ç›®æ¨™ã® 90% ã‚’ä¸Šå›ã‚Šã¾ã—ãŸ..."
```

### **ä¾‹2: é«˜å„ªå…ˆåº¦ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã®å³åº§å®Ÿè¡Œ**
```
ãƒ¦ãƒ¼ã‚¶ãƒ¼: "ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®å‰ææ¡ä»¶ã€ä½•ã ã£ãŸã£ã‘ï¼Ÿ"

è‡ªå‹•å®Ÿè¡Œãƒ•ãƒ­ãƒ¼:
1. "å‰ææ¡ä»¶" â†’ constraints ã‚«ãƒ†ã‚´ãƒªï¼ˆpriority: highï¼‰æ¤œå‡º
2. ãƒ‡ãƒã‚¦ãƒ³ã‚¹ç„¡è¦–ã§å³åº§å®Ÿè¡Œ
3. è‡ªå‹•ã‚¯ã‚¨ãƒªç”Ÿæˆ: "ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ å‰ææ¡ä»¶ åˆ¶ç´„ è¦ä»¶"
4. å¼·åˆ¶çš„ã« search_memories å®Ÿè¡Œ
5. å‰ææ¡ä»¶é–¢é€£ã®è¨˜æ†¶ã‚’æœ€å„ªå…ˆå–å¾—

AIå¿œç­”: "ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®å‰ææ¡ä»¶ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ï¼š
1. Python 3.9ä»¥ä¸Šå¿…é ˆ
2. SQLite ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ä½¿ç”¨
3. MCP ãƒ—ãƒ­ãƒˆã‚³ãƒ«æº–æ‹ ..."
```

### **ä¾‹3: ãƒ¦ãƒ¼ã‚¶ãƒ¼å€‹åˆ¥è¨­å®šã®è‡ªå‹•é©ç”¨**
```
ãƒ¦ãƒ¼ã‚¶ãƒ¼: "MCP ã®å®Ÿè£…ã€é€²ã‚“ã§ã‚‹ï¼Ÿ"

è‡ªå‹•å®Ÿè¡Œãƒ•ãƒ­ãƒ¼:
1. "MCP" â†’ kechirojpå°‚ç”¨ mcp_specific ã‚«ãƒ†ã‚´ãƒªæ¤œå‡º
2. å€‹äººè¨­å®šã®é«˜å„ªå…ˆåº¦é©ç”¨
3. å°‚é–€ç”¨èªã¨ã—ã¦ç‰¹åˆ¥å‡¦ç†
4. è‡ªå‹•ã‚¯ã‚¨ãƒªç”Ÿæˆ: "MCP å®Ÿè£… é€²æ— é–‹ç™º"
5. æŠ€è¡“çš„ãªè¨˜æ†¶ã‚’é‡ç‚¹æ¤œç´¢

AIå¿œç­”: "MCP (Model Context Protocol) ã®å®Ÿè£…ã¯é †èª¿ã§ã™ã€‚
ç¾åœ¨ Phase 4 ã®é€²åŒ–ã‚·ã‚¹ãƒ†ãƒ ã¾ã§å®Œæˆã—ã¦ã„ã¦..."
```

## ğŸš€ **ã‚·ã‚¹ãƒ†ãƒ ã®é©æ–°æ€§**

### **å®Œå…¨é€æ˜åŒ–**
- **ãƒ¦ãƒ¼ã‚¶ãƒ¼**: æ™®é€šã«ä¼šè©±ã™ã‚‹ã ã‘
- **ã‚·ã‚¹ãƒ†ãƒ **: è£ã§è‡ªå‹•çš„ã«è¨˜æ†¶è£œå®Œ
- **ä½“é¨“**: ã€ŒAIãŒå¿˜ã‚Œãªã„ã€æ„Ÿè¦š

### **å€‹äººæœ€é©åŒ–**
- **å­¦ç¿’**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è¨€èªç¿’æ…£ã‚’å­¦ç¿’
- **é€²åŒ–**: ä½¿ç”¨ãƒ‘ã‚¿ãƒ¼ãƒ³ã«å¿œã˜ã¦è‡ªå‹•èª¿æ•´
- **å°‚é–€åŒ–**: å€‹äººã®å°‚é–€åˆ†é‡ã«ç‰¹åŒ–

### **é›¶æ‘©æ“¦UX**
- **ã‚³ãƒãƒ³ãƒ‰ä¸è¦**: è‡ªç„¶è¨€èªã®ã¿
- **è¨­å®šä¸è¦**: å…¨è‡ªå‹•ç®¡ç†
- **å­¦ç¿’ä¸è¦**: ä½¿ã†ã ã‘ã§æœ€é©åŒ–

ã“ã®è‡ªå‹•ãƒˆãƒªã‚¬ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚·ã‚¹ãƒ†ãƒ ã«ã‚ˆã‚Šã€**ã€ŒAIãŒå‰ææ¡ä»¶ã‚’å¿˜ã‚Œã‚‹ã€å•é¡ŒãŒæ ¹æœ¬è§£æ±º**ã•ã‚Œã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ long_memory_MCP ã®å­˜åœ¨ã‚’æ„è­˜ã™ã‚‹ã“ã¨ãªãã€åŠ‡çš„ã«æ”¹å–„ã•ã‚ŒãŸAIä½“é¨“ã‚’äº«å—ã§ãã¾ã™ï¼ğŸ‰